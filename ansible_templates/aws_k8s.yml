#Ansible Jenkins Master, sample playbook - jenkins-master-sample.yml
---
- hosts: "{{ passed_in_hosts }}"
  #hosts: tag_Name_aws_sandbox_tf_1 
  become: yes
  remote_user: ec2-user
  become_user: root
  tasks:
    - name: create the k8suser user account
      user: name=k8suser state=present createhome=yes shell=/bin/bash
      #user: name=k8suser append=yes groups=k8suser state=present createhome=yes shell=/bin/bash

    - name: create directory for each user
      file: 
        path: /home/k8suser/.ssh
        state: directory
        owner: k8suser
        group: k8suser
        mode: '0700'

    - name: allow 'k8suser' to use sudo without needing a password
      lineinfile:
        dest: /etc/sudoers
        line: 'k8suser ALL=(ALL) NOPASSWD: ALL'
        validate: 'visudo -cf %s'

    - name: copy key file to specific location
      copy:
        src: id_rsa.pub
        dest: /home/k8suser/.ssh/authorized_keys
        owner: k8suser
        group: k8suser
        mode: '0600'